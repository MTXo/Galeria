<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Galeria.MainPage"
             BackgroundColor="#FAFAFA">

    <Grid RowDefinitions="Auto,Auto,Auto,*">

        <!-- Górny pasek z tytułem i przyciskiem "Zapisane" -->
        <Grid HeightRequest="70" BackgroundColor="#2C3E50" Grid.Row="0">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <Label Text="Galeria zdjęć"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"
                       Grid.Column="0"/>

                <!-- Przycisk ZAPISANE -->
                <Button Text="Zapisane"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="25"
                        WidthRequest="120"
                        HeightRequest="48"
                        FontSize="14"
                        Margin="10"
                        Grid.Column="1"
                        Clicked="ToggleFoldersPanel_Clicked"/>
            </Grid>
        </Grid>

        <!-- Przycisk DODAJ FOLDER (pod paskiem) -->
        <Button Text="Dodaj folder ze zdjęciami"
                Clicked="AddFolderButton_Clicked"
                BackgroundColor="#27AE60"
                TextColor="White"
                FontSize="18"
                HeightRequest="60"
                CornerRadius="12"
                Margin="20,10"
                Grid.Row="1"/>

        <!-- WYSZUKIWARKA -->
        <Entry x:Name="SearchEntry"
               Grid.Row="2"
               Margin="20,0,20,10"
               HeightRequest="50"
               Placeholder="Szukaj zdjęć..."
               BackgroundColor="White"
               TextChanged="SearchEntry_TextChanged"/>

        <!-- Główna galeria -->
        <ScrollView Grid.Row="3">
            <FlexLayout x:Name="GalleryLayout"
                        Wrap="Wrap"
                        JustifyContent="Center"
                        AlignItems="Start"
                        Margin="5"/>
        </ScrollView>

        <!-- Panel z listą zapisanych folderów (overlay) -->
        <Grid x:Name="FoldersPanel"
              Grid.Row="0"
              Grid.RowSpan="3"
              BackgroundColor="#CC000000"
              IsVisible="False">

            <Frame BackgroundColor="White"
                   CornerRadius="20"
                   HasShadow="True"
                   Padding="20"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   WidthRequest="420"
                   HeightRequest="560">

                <Grid RowDefinitions="Auto,*,Auto" RowSpacing="20">
                    <Label Text="Zapisane foldery"
                           FontSize="22"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           Grid.Row="0"/>

                    <CollectionView x:Name="FoldersListView"
                        Grid.Row="1"
                        HeightRequest="400">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="12" 
                                  ColumnDefinitions="*,Auto"
                                  ColumnSpacing="15">

                                    <ScrollView Orientation="Horizontal"
                                        Grid.Column="0"
                                        VerticalOptions="Center">
                                        <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="10">
                                            <Image Source="folder.png"
                                               HeightRequest="32"
                                               WidthRequest="32"
                                               VerticalOptions="Center"
                                               Grid.Column="0"/>

                                            <Label Text="{Binding .}"
                                               FontSize="15"
                                               TextColor="#2C3E50"
                                               VerticalOptions="Center"
                                               Grid.Column="1"/>
                                        </Grid>
                                    </ScrollView>

                                    <Button Text="Usuń"
                                        BackgroundColor="#E74C3C"
                                        TextColor="White"
                                        CornerRadius="10"
                                        WidthRequest="90"
                                        HeightRequest="42"
                                        FontSize="13"
                                        CommandParameter="{Binding .}"
                                        Clicked="RemoveFolderButton_Clicked"
                                        Grid.Column="1"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <Button Text="Zamknij"
                            BackgroundColor="#34495E"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="55"
                            FontSize="16"
                            Grid.Row="2"
                            Clicked="CloseFoldersPanel_Clicked"/>
                </Grid>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>